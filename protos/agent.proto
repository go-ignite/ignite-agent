syntax = "proto3";
option go_package = "github.com/go-ignite/ignite-agent/protos";

service AgentService {
    rpc NodeHeartbeat(GeneralRequest) returns (stream HeartbeatStreamServer);
    rpc ServiceHeartbeat(GeneralRequest) returns (stream HeartbeatStreamServer);

    rpc Init(GeneralRequest) returns (GeneralResponse);
    rpc GetAvailablePort(GetAvailablePortRequest) returns (GetAvailablePortResponse);
    rpc CreateService(CreateServiceRequest) returns (CreateServiceResponse);
	rpc StopService(StopServiceRequest) returns (GeneralResponse);
	rpc RemoveService(RemoveServiceRequest) returns (GeneralResponse);
}

message ServiceType {
    enum Enum {
        NOT_SET = 0;
  	    SS_LIBEV = 1;
        SSR = 2;
    }
}


message GeneralRequest {
	string token = 1;
}

message GeneralResponse {}

message HeartbeatStreamServer{}

message GetAvailablePortRequest {
	string token = 1;
	repeated int32 used_ports = 2;
	int32 port_from = 3;
	int32 port_to = 4;
}

message GetAvailablePortResponse {
	int32 port = 1;
}

message CreateServiceRequest {
	string token = 1;
	int32 port = 2;
	ServiceType.Enum type = 3;
	string method = 4;
	string password = 5;
	string name = 6;
}

message CreateServiceResponse {
	string service_id = 1;
}

message StopServiceRequest {
	string token = 1;
	string service_id = 2;
}

message RemoveServiceRequest {
	string token = 1;
	string service_id = 2;
}
